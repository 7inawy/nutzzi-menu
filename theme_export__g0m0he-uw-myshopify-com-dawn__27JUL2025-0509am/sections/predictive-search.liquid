{% comment %}theme-check-disable ImgLazyLoading{% endcomment %}
{%- if predictive_search.performed -%}
  {% assign first_column_results_size = predictive_search.resources.queries.size
    | plus: predictive_search.resources.collections.size
    | plus: predictive_search.resources.pages.size
    | plus: predictive_search.resources.articles.size
  %}
  <div id="predictive-search-results" class="predictive-search__results" role="listbox">
    {%- if first_column_results_size > 0 or predictive_search.resources.products.size > 0 -%}
      <div
        id="predictive-search-results-groups-wrapper"
        class="predictive-search__results-groups-wrapper{% unless predictive_search.resources.products.size > 0 %} predictive-search__results-groups-wrapper--no-products{% endunless %}{% unless predictive_search.resources.queries.size > 0 or predictive_search.resources.collections.size > 0 %} predictive-search__results-groups-wrapper--no-suggestions{% endunless %}"
      >
        
        <!-- Enhanced Product Results Section -->
        {%- if predictive_search.resources.products.size > 0 -%}
          <div class="predictive-search__result-group predictive-search__result-group--products">
            <div class="predictive-search__group-header">
              <h2 id="predictive-search-products" class="predictive-search__heading text-body caption-with-letter-spacing">
                {{- 'templates.search.products' | t -}}
                <span class="predictive-search__count">({{ predictive_search.resources.products.size }})</span>
              </h2>
              <a href="{{ routes.search_url }}?q={{ predictive_search.terms | escape }}" class="predictive-search__view-all">
                {{ 'templates.search.view_all_products' | t }}
              </a>
            </div>
            <ul
              id="predictive-search-results-list"
              class="predictive-search__results-list predictive-search__results-list--products list-unstyled"
              role="group"
              aria-labelledby="predictive-search-products"
            >
              {%- for product in predictive_search.resources.products -%}
                <li
                  id="predictive-search-option-product-{{ forloop.index }}"
                  class="predictive-search__list-item predictive-search__list-item--product"
                  role="option"
                  aria-selected="false"
                >
                  <a href="{{ product.url }}" class="predictive-search__item predictive-search__item--product link link--text" tabindex="-1">
                    <div class="predictive-search__item-content">
                      <div class="predictive-search__item-image">
                        {%- if product.featured_media -%}
                          {{ product.featured_media | image_url: width: 80 | image_tag: 
                            class: 'predictive-search__item-img',
                            loading: 'lazy',
                            alt: product.featured_media.alt | escape
                          }}
                        {%- else -%}
                          <div class="predictive-search__item-placeholder">
                            {{ 'icon-product.svg' | inline_asset_content }}
                          </div>
                        {%- endif -%}
                      </div>
                      <div class="predictive-search__item-details">
                        <h3 class="predictive-search__item-heading h5">{{ product.title | escape }}</h3>
                        {%- if product.vendor -%}
                          <p class="predictive-search__item-vendor">{{ product.vendor | escape }}</p>
                        {%- endif -%}
                        <div class="predictive-search__item-price">
                          {%- render 'price', product: product, use_variant: true, show_badges: false -%}
                        </div>
                        {%- if product.available == false -%}
                          <p class="predictive-search__item-availability">{{ 'products.product.sold_out' | t }}</p>
                        {%- endif -%}
                      </div>
                      <div class="predictive-search__item-actions">
                        <button type="button" class="predictive-search__quick-add" data-product-id="{{ product.id }}" aria-label="{{ 'products.product.add_to_cart' | t }}">
                          {{ 'icon-plus.svg' | inline_asset_content }}
                        </button>
                      </div>
                    </div>
                  </a>
                </li>
              {%- endfor -%}
            </ul>
          </div>
        {%- endif -%}

        <!-- Enhanced Suggestions Section -->
        {%- if first_column_results_size > 0 -%}
          <div class="predictive-search__result-group predictive-search__result-group--suggestions">
            <div class="predictive-search__group-header">
              <h2 id="predictive-search-suggestions" class="predictive-search__heading text-body caption-with-letter-spacing">
                {{- 'templates.search.suggestions' | t -}}
              </h2>
            </div>
            
            <!-- Search Queries and Collections -->
            {%- if predictive_search.resources.queries.size > 0 or predictive_search.resources.collections.size > 0 -%}
              <div class="predictive-search__suggestions">
                <ul
                  id="predictive-search-results-queries-list"
                  class="predictive-search__results-list predictive-search__results-list--suggestions list-unstyled"
                  role="group"
                  aria-labelledby="predictive-search-suggestions"
                >
                  {%- for query in predictive_search.resources.queries -%}
                    <li
                      id="predictive-search-option-query-{{ forloop.index }}"
                      class="predictive-search__list-item predictive-search__list-item--suggestion"
                      role="option"
                      aria-selected="false"
                    >
                      <a href="{{ query.url }}" class="predictive-search__item predictive-search__item--suggestion link link--text" tabindex="-1">
                        <div class="predictive-search__item-content predictive-search__item-content--centered">
                          <span class="predictive-search__item-icon">{{ 'icon-search.svg' | inline_asset_content }}</span>
                          <p
                            class="predictive-search__item-heading predictive-search__item-query-result h5"
                            aria-label="{{ query.text }}"
                          >
                            {{ query.styled_text }}
                          </p>
                        </div>
                      </a>
                    </li>
                  {%- endfor -%}
                  {%- for collection in predictive_search.resources.collections -%}
                    <li
                      id="predictive-search-option-collection-{{ forloop.index }}"
                      class="predictive-search__list-item predictive-search__list-item--suggestion"
                      role="option"
                      aria-selected="false"
                    >
                      <a href="{{ collection.url }}" class="predictive-search__item predictive-search__item--suggestion link link--text" tabindex="-1">
                        <div class="predictive-search__item-content predictive-search__item-content--centered">
                          <span class="predictive-search__item-icon">{{ 'icon-filter.svg' | inline_asset_content }}</span>
                          <div class="predictive-search__item-details">
                            <p class="predictive-search__item-heading h5">{{ collection.title | escape }}</p>
                            <p class="predictive-search__item-count">{{ collection.products_count }} {{ 'templates.search.products' | t }}</p>
                          </div>
                        </div>
                      </a>
                    </li>
                  {%- endfor -%}
                </ul>
              </div>
            {%- endif -%}

            <!-- Pages and Articles -->
            {%- if predictive_search.resources.articles.size > 0 or predictive_search.resources.pages.size > 0 -%}
              <div class="predictive-search__pages-wrapper">
                <h3
                  id="predictive-search-pages-desktop"
                  class="predictive-search__subheading text-body caption-with-letter-spacing"
                >
                  {{- 'templates.search.pages' | t -}}
                </h3>
                <ul
                  id="predictive-search-results-pages-list-desktop"
                  class="predictive-search__results-list predictive-search__results-list--pages list-unstyled"
                  role="group"
                  aria-labelledby="predictive-search-pages-desktop"
                >
                  {%- for page in predictive_search.resources.pages -%}
                    <li
                      id="predictive-search-option-page-desktop-{{ forloop.index }}"
                      class="predictive-search__list-item predictive-search__list-item--page"
                      role="option"
                      aria-selected="false"
                    >
                      <a href="{{ page.url }}" class="predictive-search__item predictive-search__item--page link link--text" tabindex="-1">
                        <div class="predictive-search__item-content predictive-search__item-content--centered">
                          <span class="predictive-search__item-icon">{{ 'icon-document.svg' | inline_asset_content }}</span>
                          <p class="predictive-search__item-heading h5">{{ page.title | escape }}</p>
                        </div>
                      </a>
                    </li>
                  {%- endfor -%}
                  {%- for article in predictive_search.resources.articles -%}
                    <li
                      id="predictive-search-option-article-desktop-{{ forloop.index }}"
                      class="predictive-search__list-item predictive-search__list-item--article"
                      role="option"
                      aria-selected="false"
                    >
                      <a href="{{ article.url }}" class="predictive-search__item predictive-search__item--article link link--text" tabindex="-1">
                        <div class="predictive-search__item-content predictive-search__item-content--centered">
                          <span class="predictive-search__item-icon">{{ 'icon-article.svg' | inline_asset_content }}</span>
                          <div class="predictive-search__item-details">
                            <p class="predictive-search__item-heading h5">{{ article.title | escape }}</p>
                            <p class="predictive-search__item-meta">{{ article.published_at | date: '%B %d, %Y' }}</p>
                          </div>
                        </div>
                      </a>
                    </li>
                  {%- endfor -%}
                </ul>
              </div>
            {%- endif -%}
          </div>
        {%- endif -%}
      </div>
    {%- endif -%}
  </div>

  <!-- No Results State -->
  {%- if first_column_results_size == 0 and predictive_search.resources.products.size == 0 -%}
    <div class="predictive-search__no-results">
      <div class="predictive-search__no-results-content">
        <span class="predictive-search__no-results-icon">{{ 'icon-search.svg' | inline_asset_content }}</span>
        <h3 class="predictive-search__no-results-title">{{ 'templates.search.no_results_title' | t }}</h3>
        <p class="predictive-search__no-results-text">{{ 'templates.search.no_results_text' | t: terms: predictive_search.terms }}</p>
        <div class="predictive-search__no-results-actions">
          <a href="{{ routes.search_url }}?q={{ predictive_search.terms | escape }}" class="button button--primary">
            {{ 'templates.search.view_all_results' | t }}
          </a>
          <a href="{{ routes.collections_url }}" class="button button--secondary">
            {{ 'templates.search.browse_collections' | t }}
          </a>
        </div>
      </div>
    </div>
  {%- endif -%}
{%- endif -%}
